<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google Analytics 4 -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-XXXXXXXXXX');
</script>
<meta charset="UTF-8">
<title>Judgement - Play Multiplayer Free | Real-Time Addictive Card Game</title>
<meta name="description" content="Play Judgement card game online with friends. Free multiplayer card game with real-time gameplay, lobby system, and intuitive interface. Start playing now!">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
<link rel="stylesheet" href="styles.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
<!-- Project JavaScript Modules -->
<script src="js/analytics.js"></script>
<script src="js/config.js"></script>
<script src="js/state.js"></script>
<script src="js/utils.js"></script>
<script src="js/validation.js"></script>
<script src="js/tabs.js"></script>
<script src="js/register.js"></script>
<script src="js/lobby.js"></script>
<script src="js/ui.js"></script>
<script src="js/game.js"></script>
<script src="js/scorecard.js"></script>
<script src="js/reactions.js"></script>
<script src="js/userMenu.js"></script>
<script src="js/init.js"></script>
</head>
<body>

<!-- User Dropdown Menu -->
<div id="userMenu">
  <button id="resetToLobbyBtn" onclick="resetToLobby()">Reset to Lobby</button>
  <button id="leaveGameBtn" onclick="leaveGame()">Leave Game</button>
  <button id="newGameBtn" onclick="newGame()">New Game</button>
  <button id="debugSkipRound" onclick="debugSkipToNextRound()" style="display:none; background:#ff9800; border-top: 1px solid rgba(255,255,255,0.1);">‚ö° Skip to Next Round (DEBUG)</button>
</div>

<!-- Scorecard Overlay -->
<div id="scorecardOverlay" onclick="toggleScorecard()">
  <div id="scorecardModal" onclick="event.stopPropagation()">
    <div class="scorecard-header">
      <h2 id="scorecardTitle">Game Scoreboard</h2>
      <p id="scorecardLobbyCode" class="scorecard-lobby-code"></p>
    </div>
    <button class="close-btn" onclick="toggleScorecard()">‚úï</button>
    <div id="scorecardContent"></div>
  </div>
</div>

<!-- Reconnection Waiting Overlay -->
<div id="reconnectOverlay" class="reconnect-overlay" style="display: none;">
  <div class="reconnect-modal">
    <div class="reconnect-icon">‚ö†Ô∏è</div>
    <h2>Player Disconnected</h2>
    <p id="reconnectPlayerName" class="reconnect-player">Waiting for player...</p>
    <div class="reconnect-timer">
      <div class="timer-circle">
        <span id="reconnectTimer">300</span>
      </div>
      <p class="timer-label">seconds remaining</p>
    </div>
    <p class="reconnect-message">The game will resume when they reconnect</p>
    <div class="reconnect-actions">
      <button class="dismiss-btn" onclick="dismissReconnectModal()">Dismiss</button>
    </div>
  </div>
</div>

<!-- Registration Screen -->
<div id="register" class="screen active">
  <div class="register-container">
    <div class="register-header">
      <h1>Game of Judgement</h1>
      <p class="tagline">Play the Ultimate Card Game Online</p>
    </div>
    
    <!-- Resume Game Banner (hidden by default) -->
    <div id="resumeBanner" class="resume-banner" style="display: none;">
      <div class="resume-content">
        <h3>Continue your game <span id="resumePlayerName"></span>?</h3>
        <p>You have an active session in lobby <strong id="resumeLobbyCode"></strong></p>
      </div>
      <div class="resume-actions">
        <button class="resume-btn" onclick="resumeGame()">Resume</button>
        <button class="dismiss-resume-btn" onclick="dismissResume()">Dismiss</button>
      </div>
    </div>
    
    <!-- Tabbed Registration Interface -->
    <div class="register-form">
      <!-- Tab Buttons -->
      <div class="registration-tabs">
        <button class="tab-btn active" id="createTab" onclick="switchRegistrationTab('create')">
          <span>Create Lobby</span>
        </button>
        <button class="tab-btn" id="joinTab" onclick="switchRegistrationTab('join')">
          <span>Join Lobby</span>
        </button>
      </div>

      <!-- Create Lobby Tab Content -->
      <div class="tab-content active" id="createTabContent">
        <div class="input-group">
          <label for="playerNameCreate">Player Name</label>
          <input 
            type="text" 
            id="playerNameCreate" 
            placeholder="ENTER YOUR NAME" 
            maxlength="20" 
            autofocus
            oninput="formatPlayerNameInput(this)">
          <div class="input-error-message" id="playerNameCreateError"></div>
        </div>

        <div class="input-group">
          <label for="avatarSelectCreate">Choose Your Avatar</label>
          <div class="avatar-grid-container">
            <div class="avatar-grid" id="avatarGridCreate">
              <!-- Avatars will be generated here -->
            </div>
          </div>
        </div>

        <button class="primary-btn" onclick="createLobby()">
          <span>Create New Lobby</span>
        </button>

        <!-- How to Play Section - Timeline Design -->
        <div class="how-to-play-section">
          <button class="how-to-play-toggle" onclick="toggleHowToPlay(this)">
            <span>New to the game? Learn how to play</span>
            <span class="toggle-arrow">‚ñº</span>
          </button>
          <div class="how-to-play-content">
            <div class="timeline-container">
              <div class="timeline-track">
                <div class="timeline-steps">
                  <div class="step-wrapper" data-step="0">
                    <div class="step-dot active" onclick="showStep(this, 0)">1</div>
                    <div class="step-label">Bid</div>
                  </div>
                  <div class="step-wrapper" data-step="1">
                    <div class="step-dot" onclick="showStep(this, 1)">2</div>
                    <div class="step-label">Play</div>
                  </div>
                  <div class="step-wrapper" data-step="2">
                    <div class="step-dot" onclick="showStep(this, 2)">3</div>
                    <div class="step-label">Score</div>
                  </div>
                  <div class="step-wrapper" data-step="3">
                    <div class="step-dot" onclick="showStep(this, 3)">4</div>
                    <div class="step-label">Win</div>
                  </div>
                </div>
              </div>
              <div class="step-contents">
                <div class="step-content-box active" data-step="0">
                  <h4>üéØ Place Your Bid</h4>
                  <p>Look at your cards and predict exactly how many hands you'll win this round (0 or more).</p>
                </div>
                <div class="step-content-box" data-step="1">
                  <h4>üÉè Play Your Cards</h4>
                  <p>Each round uses fewer cards (7‚Üí6‚Üí5...). Follow suit or play trump to win hands!</p>
                </div>
                <div class="step-content-box" data-step="2">
                  <h4>‚≠ê Earn Points</h4>
                  <p><strong>Exact</strong> = +20 pts ‚Ä¢ <strong>Under</strong> = 0 pts ‚Ä¢ <strong>Over</strong> = hands won<br><em>Example: Bid 3, win 3 = 20 pts | Win 2 = 0 pts | Win 4 = 4 pts</em></p>
                </div>
                <div class="step-content-box" data-step="3">
                  <h4>üèÜ Win the Game</h4>
                  <p>Highest total score after all rounds wins! Accuracy beats luck.</p>
                </div>
              </div>
              <div class="nav-dots">
                <div class="nav-dot active" onclick="showStep(this, 0)" data-step="0"></div>
                <div class="nav-dot" onclick="showStep(this, 1)" data-step="1"></div>
                <div class="nav-dot" onclick="showStep(this, 2)" data-step="2"></div>
                <div class="nav-dot" onclick="showStep(this, 3)" data-step="3"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Join Lobby Tab Content -->
      <div class="tab-content" id="joinTabContent">
        <div class="input-group">
          <label for="playerNameJoin">Player Name</label>
          <input 
            type="text" 
            id="playerNameJoin" 
            placeholder="ENTER YOUR NAME" 
            maxlength="20"
            oninput="formatPlayerNameInput(this)">
          <div class="input-error-message" id="playerNameJoinError"></div>
        </div>

        <div class="input-group">
          <label for="lobbyCodeInput">Lobby Code</label>
          <input 
            type="text" 
            id="lobbyCodeInput" 
            placeholder="ENTER LOBBY CODE" 
            maxlength="8" 
            style="text-transform: uppercase;"
            oninput="formatLobbyCodeInput(this)">
          <div class="input-error-message" id="lobbyCodeInputError"></div>
        </div>

        <div class="input-group">
          <label for="avatarSelectJoin">Choose Your Avatar</label>
          <div class="avatar-grid-container">
            <div class="avatar-grid" id="avatarGridJoin">
              <!-- Avatars will be generated here -->
            </div>
          </div>
        </div>

        <button class="primary-btn" onclick="joinLobby()">
          <span>Join Lobby</span>
        </button>

        <!-- How to Play Section - Timeline Design -->
        <div class="how-to-play-section">
          <button class="how-to-play-toggle" onclick="toggleHowToPlay(this)">
            <span>New to the game? Learn how to play</span>
            <span class="toggle-arrow">‚ñº</span>
          </button>
          <div class="how-to-play-content">
            <div class="timeline-container">
              <div class="timeline-track">
                <div class="timeline-steps">
                  <div class="step-wrapper" data-step="0">
                    <div class="step-dot active" onclick="showStep(this, 0)">1</div>
                    <div class="step-label">Bid</div>
                  </div>
                  <div class="step-wrapper" data-step="1">
                    <div class="step-dot" onclick="showStep(this, 1)">2</div>
                    <div class="step-label">Play</div>
                  </div>
                  <div class="step-wrapper" data-step="2">
                    <div class="step-dot" onclick="showStep(this, 2)">3</div>
                    <div class="step-label">Score</div>
                  </div>
                  <div class="step-wrapper" data-step="3">
                    <div class="step-dot" onclick="showStep(this, 3)">4</div>
                    <div class="step-label">Win</div>
                  </div>
                </div>
              </div>
              <div class="step-contents">
                <div class="step-content-box active" data-step="0">
                  <h4>üéØ Place Your Bid</h4>
                  <p>Look at your cards and predict exactly how many hands you'll win this round (0 or more).</p>
                </div>
                <div class="step-content-box" data-step="1">
                  <h4>üÉè Play Your Cards</h4>
                  <p>Each round uses fewer cards (7‚Üí6‚Üí5...). Follow suit or play trump to win hands!</p>
                </div>
                <div class="step-content-box" data-step="2">
                  <h4>‚≠ê Earn Points</h4>
                  <p><strong>Exact</strong> = +20 pts ‚Ä¢ <strong>Under</strong> = 0 pts ‚Ä¢ <strong>Over</strong> = hands won<br><em>Example: Bid 3, win 3 = 20 pts | Win 2 = 0 pts | Win 4 = 4 pts</em></p>
                </div>
                <div class="step-content-box" data-step="3">
                  <h4>üèÜ Win the Game</h4>
                  <p>Highest total score after all rounds wins! Accuracy beats luck.</p>
                </div>
              </div>
              <div class="nav-dots">
                <div class="nav-dot active" onclick="showStep(this, 0)" data-step="0"></div>
                <div class="nav-dot" onclick="showStep(this, 1)" data-step="1"></div>
                <div class="nav-dot" onclick="showStep(this, 2)" data-step="2"></div>
                <div class="nav-dot" onclick="showStep(this, 3)" data-step="3"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ===== LOBBY SCREEN ===== -->
<div id="lobby" class="screen">
  <div class="lobby-container">
    <div class="lobby-game-header" id="lobbyGameHeader">
      <h1>Game of Judgement</h1>
      <p class="tagline">Play the Ultimate Card Game Online</p>
    </div>
    
    <div class="lobby-header">
      <h1>Lobby</h1>
    </div>
    
    <div id="lobbyInfo" class="lobby-info-card"></div>
    
    <div class="players-section">
      <h3 class="section-title">Players</h3>
      <div id="lobbyList" class="lobby-list"></div>
    </div>
    
    <div id="roundSelectContainer" class="game-settings" style="display:none;">
      <div class="input-group">
        <label>Starting Cards</label>
        <div id="roundSelect" class="custom-dropdown lobby-dropdown">
          <div class="dropdown-selected">26 cards</div>
          <div class="dropdown-arrow">‚ñº</div>
          <div class="dropdown-options"></div>
        </div>
        <small class="helper-text">Select number of cards to start with (Round 1)</small>
      </div>
    </div>
    
    <button id="startBtn" class="start-game-btn" style="display:none;" onclick="startGame()">
      <span>Start Game</span>
    </button>
    
    <!-- How to Play section for waiting players - Timeline Design -->
    <div id="lobbyHowToPlay" class="how-to-play-section lobby-how-to-play" style="display:none;">
      <button class="how-to-play-toggle" onclick="toggleHowToPlay(this)">
        <span>New to the game? Learn how to play</span>
        <span class="toggle-arrow">‚ñº</span>
      </button>
      <div class="how-to-play-content">
        <div class="timeline-container">
          <div class="timeline-track">
            <div class="timeline-steps">
              <div class="step-wrapper" data-step="0">
                <div class="step-dot active" onclick="showStep(this, 0)">1</div>
                <div class="step-label">Bid</div>
              </div>
              <div class="step-wrapper" data-step="1">
                <div class="step-dot" onclick="showStep(this, 1)">2</div>
                <div class="step-label">Play</div>
              </div>
              <div class="step-wrapper" data-step="2">
                <div class="step-dot" onclick="showStep(this, 2)">3</div>
                <div class="step-label">Score</div>
              </div>
              <div class="step-wrapper" data-step="3">
                <div class="step-dot" onclick="showStep(this, 3)">4</div>
                <div class="step-label">Win</div>
              </div>
            </div>
          </div>
          <div class="step-contents">
            <div class="step-content-box active" data-step="0">
              <h4>üéØ Place Your Bid</h4>
              <p>Look at your cards and predict exactly how many hands you'll win this round (0 or more).</p>
            </div>
            <div class="step-content-box" data-step="1">
              <h4>üÉè Play Your Cards</h4>
              <p>Each round uses fewer cards (7‚Üí6‚Üí5...). Follow suit or play trump to win hands!</p>
            </div>
            <div class="step-content-box" data-step="2">
              <h4>‚≠ê Earn Points</h4>
              <p><strong>Exact</strong> = +20 pts ‚Ä¢ <strong>Under</strong> = 0 pts ‚Ä¢ <strong>Over</strong> = hands won<br><em>Example: Bid 3, win 3 = 20 pts | Win 2 = 0 pts | Win 4 = 4 pts</em></p>
            </div>
            <div class="step-content-box" data-step="3">
              <h4>üèÜ Win the Game</h4>
              <p>Highest total score after all rounds wins! Accuracy beats luck.</p>
            </div>
          </div>
          <div class="nav-dots">
            <div class="nav-dot active" onclick="showStep(this, 0)" data-step="0"></div>
            <div class="nav-dot" onclick="showStep(this, 1)" data-step="1"></div>
            <div class="nav-dot" onclick="showStep(this, 2)" data-step="2"></div>
            <div class="nav-dot" onclick="showStep(this, 3)" data-step="3"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ===== GAME SCREEN ===== -->
<div id="game" class="screen">
  <!-- Top Bar -->
  <div id="gameTopBar">
    <div class="top-bar-item">
      <button id="scorecardBtn" onclick="toggleScorecard()">
        <img src="assets/score-icon.svg" alt="Score" class="scorecard-icon">
      </button>
      <div class="item-label-below">
        <span class="label-key">Score</span>
        <span class="label-value" id="myScoreLabel">0</span>
      </div>
    </div>
    
    <!-- Center Message -->
    <div id="centerMsg"></div>
    
    <div class="top-bar-item">
      <div id="userInfo" onclick="toggleUserMenu()">
        <img id="userInfoAvatar" src="" alt="avatar">
      </div>
      <div class="item-label-below">
        <span class="label-key">You</span>
        <span class="label-value" id="myNameLabel"></span>
      </div>
    </div>
  </div>
  
  <!-- Game Content -->
  <div class="game-content">
    
    <!-- Deal Button (only dealer sees this) -->
    <button id="dealBtn" style="display:none;" onclick="dealCards()">Deal Cards</button>
    
    <!-- Bidding UI -->
    <div id="biddingUI">
      <p id="biddingPrompt"></p>
      <div>
        <div id="customDropdown" class="custom-dropdown">
          <div class="dropdown-selected" id="dropdownSelected">0</div>
          <div class="dropdown-arrow">‚ñº</div>
          <div class="dropdown-options" id="dropdownOptions"></div>
        </div>
        <button onclick="submitBid()">Submit</button>
      </div>
    </div>
    
    <!-- Center Playing Table -->
    <div id="table"></div>
    
    <!-- Player's Hand (Cards) -->
    <div class="hand" id="myHand"></div>
  
    <!-- Emoji Reaction Bar -->
    <div class="emoji-reaction-bar">
      <button class="emoji-btn" onclick="sendReaction('üëç', this)" title="Thumbs up">üëç</button>
      <button class="emoji-btn" onclick="sendReaction('üî•', this)" title="Fire">üî•</button>
      <button class="emoji-btn" onclick="sendReaction('üòÇ', this)" title="Laughing">üòÇ</button>
      <button class="emoji-btn" onclick="sendReaction('üò≠', this)" title="Loud Cry">üò≠</button>
      <button class="emoji-btn" onclick="sendReaction('‚ù§Ô∏è', this)" title="Heart">‚ù§Ô∏è</button>
      <button class="emoji-btn" onclick="sendReaction('üëè', this)" title="Clap">üëè</button>
      <button class="emoji-btn" onclick="sendReaction('üí©', this)" title="Poo">üí©</button>
    </div>
  
    <!-- Scoreboard -->
    <div id="scoreboard"></div>
    
    <p id="playerName" style="display:none;"></p>
  </div>
</div>

<!-- Footer -->
<footer class="footer">
  Made with <span class="heart">‚ù§Ô∏è</span> by Dinesh Khandelwal
</footer>

</body>
</html>
